<!DOCTYPE html>
<html lang="pt">
<head>
  <title>Jogadores Online | Craftsapiens</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <style>
    body { 
        background-color: #23272A; 
        color: white; 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        overflow-x: hidden;
    }
    
    /* --- ANIMAÇÕES --- */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translate3d(0, 30px, 0); }
        to { opacity: 1; transform: translate3d(0, 0, 0); }
    }

    /* --- ESTILO DO CARD (Agora é um Link <a>) --- */
    a.player-card {
        background-color: #2C2F33;
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        border-left: 4px solid transparent;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        
        /* Remove estilos padrão de link */
        text-decoration: none;
        color: white;
        cursor: pointer;
        
        /* Transições */
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), 
                    box-shadow 0.3s ease, 
                    background-color 0.3s ease;
        
        /* Configuração da animação de entrada */
        animation-duration: 0.5s;
        animation-fill-mode: both;
        opacity: 0; 
    }

    /* Efeito Hover */
    a.player-card:hover {
        transform: translateY(-5px) scale(1.02);
        background-color: #35393e;
        box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        border-left-color: #5865F2; /* Cor destaque ao passar o mouse */
        color: white; /* Garante que o texto continue branco */
    }

    /* Cabeça do Minecraft */
    .mc-head {
        width: 52px;
        height: 52px;
        border-radius: 10px;
        margin-right: 15px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        transition: transform 0.4s ease;
    }

    a.player-card:hover .mc-head {
        transform: rotate(-10deg) scale(1.1);
    }

    .player-info h5 {
        margin: 0;
        font-size: 16px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 6px;
        letter-spacing: 0.3px;
    }

    .player-meta {
        margin-top: 4px;
        font-size: 13px;
        color: #b9bbbe;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
    }

    .meta-icon {
        width: 16px;
        height: 16px;
        border-radius: 50%;
    }
    
    .divider { width: 1px; height: 12px; background-color: #4f545c; }

    /* Cores dos Cargos */
    .rank-reitor { color: #00AAAA; text-shadow: 0 0 5px rgba(0, 170, 170, 0.3); }
    .rank-dev { color: #55FFFF; text-shadow: 0 0 5px rgba(85, 255, 255, 0.3); }
    .rank-admin { color: #AA0000; text-shadow: 0 0 5px rgba(170, 0, 0, 0.3); }
    .rank-professor { color: #55FF55; }
    .rank-moderador { color: #FF5555; }
    .rank-ajuda { color: #FFAA00; }
    .rank-premium { color: #00AA00; }
    .rank-vip { color: #FFFF55; }
    .rank-default { color: #FFFFFF; }
    .rank-town { color: #4fa3d1; }

    /* Span gerado pelo conversor de cores */
    .mc-color-span { text-shadow: 1px 1px 0px rgba(0,0,0,0.5); }
  </style>
</head>
<body>

<% 
    // FUNÇÃO AUXILIAR PARA CORES MINECRAFT
    function formatMinecraftText(text) {
        if (!text) return "";
        const mcColors = {
            '0': '#000000', '1': '#0000AA', '2': '#00AA00', '3': '#00AAAA',
            '4': '#AA0000', '5': '#AA00AA', '6': '#FFAA00', '7': '#AAAAAA',
            '8': '#555555', '9': '#5555FF', 'a': '#55FF55', 'b': '#55FFFF',
            'c': '#FF5555', 'd': '#FF55FF', 'e': '#FFFF55', 'f': '#FFFFFF',
            'r': '#FFFFFF'
        };
        if (!text.includes('§')) return text;
        let parts = text.split('§');
        let html = parts[0];
        for (let i = 1; i < parts.length; i++) {
            let colorCode = parts[i].charAt(0);
            let content = parts[i].substring(1);
            if (mcColors[colorCode]) {
                html += `<span style="color: ${mcColors[colorCode]}" class="mc-color-span">${content}</span>`;
            } else {
                html += content;
            }
        }
        return html;
    }
%>

<%- include('../partials/navbar.ejs') %>

<div class="container mt-5">
    <div class="text-center mb-4">
        <h2 class="fw-bold text-uppercase" style="letter-spacing: 2px;">
            <i class="fas fa-users me-2 text-primary"></i> Jogadores Online (<%= playerList.length %>)
        </h2>
        <p class="text-secondary">Lista em tempo real do Survival Geopolítico 2</p>
    </div>
    
    <div class="row">
        <% playerList.forEach(function(player, index) { 
             const group = (player.group || "default").toLowerCase();
             const groupDisplay = group !== "default" ? group.charAt(0).toUpperCase() + group.slice(1) : "";
             const townName = player.towny && player.towny.townName ? player.towny.townName.replace(/_/g, " ") : null;
             
             // Atraso da animação (efeito cascata)
             const animDelay = (index * 0.05) + "s";
        %>
        
        <div class="col-md-6 col-lg-4">
            <a href="/player/<%= player.username %>" class="player-card" style="animation-name: fadeInUp; animation-delay: <%= animDelay %>;">
                
                <img src="https://minotar.net/helm/<%= player.username %>/64.png" class="mc-head" alt="Head">
                
                <div class="player-info w-100">
                    <h5>
                        <% if(groupDisplay) { %>
                            <span class="rank-<%= group %>">[<%= groupDisplay %>]</span>
                        <% } %>
                        
                        <span><%- formatMinecraftText(player.nickname || player.username) %></span>
                    </h5>
                    
                    <div class="player-meta">
                        <% if (player.discord) { %>
                            <div title="Discord Vinculado" style="display: flex; align-items: center;">
                                <img src="<%= player.discord.avatar %>" class="meta-icon me-1">
                                <span style="color: #dcddde;"><%= player.discord.tag %></span>
                            </div>
                        <% } else { %>
                            <span style="opacity: 0.5; font-size: 11px;"><i class="fas fa-unlink"></i> Off</span>
                        <% } %>

                        <% if (townName) { %>
                            <% if (player.discord) { %> <div class="divider"></div> <% } %>
                            <div title="Cidade" style="display: flex; align-items: center;">
                                <img src="https://cdn-icons-png.freepik.com/256/2942/2942149.png" class="meta-icon me-1">
                                <span class="rank-town"><%= townName %></span>
                            </div>
                        <% } %>
                    </div>
                </div>
            </a>
        </div>
        <% }); %>
    </div>
</div>

<script>
    // Recarrega a página automaticamente a cada 30 segundos para atualizar a lista
    setTimeout(function(){
       window.location.reload();
    }, 15000);
</script>

</body>
</html>