<!DOCTYPE html>
<html>
<head>
    <title>City</title>
    <style>
        html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; position: absolute; top: 0; left: 0; }
        .error-message, .success-message {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; padding: 10px; display: none; z-index: 1000; border-radius: 5px;
        }
        .error-message { background-color: rgba(255, 0, 0, 0.5); }
        .success-message { background-color: rgba(0, 255, 0, 0.5); }
    </style>
</head>
<body>

    <% if (cityName && cityInfo) {%>
        <iframe src="http://jogar.craftsapiens.com.br:30009/?worldname=Earth&zoom=4&x=<%=cityInfo.data.location.x%>&z=<%=cityInfo.data.location.z%>" id="cityIframe"></iframe>
        <div class="success-message" id="successMessage"><%= cityName %> (<%= cityInfo.data.mayor %>)</div>
    <% } else { %>
        <iframe src="http://jogar.craftsapiens.com.br:30009/?worldname=Earth&zoom=0.3&x=3680&z=-16254" id="cityIframe"></iframe>
        <div class="error-message" id="errorMessage"><%= cityName %> não encontrada</div>
    <% } %>

    <div id="cityNameData" data-cityname="<%= cityName %>"></div>
    <div id="cityInfoData" data-cityinfo="<%= cityInfo %>"></div>

    <script>
        (function() {
            var urlParams = new URLSearchParams(window.location.search);
            var serverType = urlParams.get('server');

            // LÓGICA DO GEO1 (MEMORIAL)
            if (serverType === 'geo1') {
                var iframe = document.getElementById('cityIframe');
                
                // Força a porta 2053 e as coordenadas exatas: X -1920, Z 928
                iframe.src = "http://jogar.craftsapiens.com.br:2053/?worldname=Earth&zoom=4&x=-1920&z=928";
                
                // Esconde mensagens de erro/sucesso do Geo2, pois não se aplicam aqui
                var err = document.getElementById('errorMessage');
                if(err) err.style.display = 'none';
                
                var succ = document.getElementById('successMessage');
                if(succ) succ.style.display = 'none';
                
                return; // Encerra o script aqui para não executar validações do Geo2
            }

            // LÓGICA DO GEO2 (PADRÃO)
            function showErrorMessage() {
                var errorMessage = document.getElementById('errorMessage');
                errorMessage.style.display = 'block';
                setTimeout(function () { errorMessage.style.display = 'none'; }, 3000);
            }

            var cityName = document.getElementById('cityNameData').getAttribute('data-cityname');
            var cityInfo = document.getElementById('cityInfoData').getAttribute('data-cityinfo');

            if (!cityInfo && cityName) { showErrorMessage(); }

            function showSuccessMessage() {
                var successMessage = document.getElementById('successMessage');
                successMessage.style.display = 'block';
                setTimeout(function () { successMessage.style.display = 'none'; }, 2000);
            }

            if (cityInfo) { showSuccessMessage(); }
        })();
    </script>
</body>
</html>